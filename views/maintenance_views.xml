<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="maintenance_request_view_form_inherit_horometer" model="ir.ui.view">
        <field name="name">maintenance.request.form.inherit.horometer</field>
        <field name="model">maintenance.request</field>
        <field name="inherit_id" ref="maintenance.hr_equipment_request_view_form"/>
        <field name="arch" type="xml">
            
            <xpath expr="//sheet/group" position="after">
                <group string="Control de Horómetro y Tiempos">
                    <group>
                        <field name="work_hours_start"/>
                        <field name="work_hours_end"/>
                    </group>
                    <group>
                        <field name="execution_start_date"/>
                        <field name="execution_end_date"/>
                    </group>
                </group>
            </xpath>

            <xpath expr="//sheet/notebook" position="inside">
                <page string="Evidencias y Firma">
                    <group>
                        <group string="Conformidad">
                            <div colspan="2" class="d-flex justify-content-between align-items-center">
                                <h3 class="mb0">Firma del Cliente</h3>
                                <button name="action_clean_signature" 
                                        type="object" 
                                        string="Limpiar" 
                                        icon="fa-trash" 
                                        class="btn btn-link text-danger btn-sm" 
                                        confirm="¿Borrar firma?"/>
                            </div>
                            <separator colspan="2"/>
                            <field name="customer_signature" 
                                widget="signature" 
                                nolabel="1" 
                                colspan="2" 
                                style="width: 400px; height: 120px; border: 1px solid #ccc;"/>
                        </group>
                        
                        <group string="Gestión de Evidencias">
                            <field name="evidence_ids" widget="many2many_binary" string="Subir Fotos Aquí"/>
                            
                            <div class="text-muted">
                                <small><i>Usa el botón de arriba para cargar o eliminar imágenes. Las previsualizaciones aparecerán abajo.</i></small>
                            </div>
                        </group>
                    </group>

                    <separator string="Galería de Fotos"/>
                    <field name="evidence_ids" mode="kanban" readonly="1">
                        <kanban string="Evidencias Fotográficas">
                            <field name="id"/>
                            <field name="mimetype"/>
                            <field name="name"/>
                            <templates>
                                <t t-name="kanban-box">
                                    <div class="oe_kanban_card">
                                        <div class="o_kanban_image" style="position: relative;">
                                            <img t-att-src="kanban_image('ir.attachment', 'datas', record.id.raw_value)" 
                                                t-if="record.mimetype.value.indexOf('image') !== -1"
                                                style="width: 100%; height: auto; object-fit: cover;"/>
                                            <img src="/web/static/img/mimetypes/unknown.svg" 
                                                t-if="record.mimetype.value.indexOf('image') === -1" 
                                                class="o_image_64_max"/>
                                        </div>
                                        <div class="o_kanban_details" style="text-align: center; padding-top: 5px;">
                                            <span style="font-size: 11px;"><field name="name"/></span>
                                        </div>
                                    </div>
                                </t>
                            </templates>
                        </kanban>
                    </field>
                </page>
            </xpath>

        </field>
    </record>
</odoo>